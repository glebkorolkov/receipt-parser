# Receipt parser

### General information
One could use [Google Cloud Vision](https://cloud.google.com/vision/) API to do optical character recognition (OCR) on images of receipts. Resulting text data could then be used to build a machine-learning model identifying various receipt metrics such as total amount, merchant name or receipt date.

My objective for this project was to build a parser for json files generated by Google Cloud Vision OCR. The parser should:
1. Read json files with OCR data
2. Extract useful information
3. Save data into csv for further analysis

### Data
For this project I used some of the receipts that my wife and myself accumulated recently. I took pictures of the receipts and cropped some of them. Actual receipt images can be downloaded from here: https://s3.amazonaws.com/receipt-labeler/receipt_images.zip.

For optical character recognition I used the 'Try the API' tool on Google Cloud Vision API page: https://cloud.google.com/vision/. It allows you to manually upload an image to the web page, then parses it and displays back json data with OCR results. I then manually copied json text and saved it on disk. See how its works:

![Google OCR use gif](https://s3.amazonaws.com/receipt-labeler/ocr_use.gif)

I could use the API itself however decided against it because I only had 39 receipts. I named my json files with the following pattern: `[number]_[alphanumeric_code].txt` (for example: `1_D19068E8A62D40E.txt`).

### Parsing
Json files from OCR contain lots of data: individual characters, words and blocks of words as well as urls, images, languages, and company names identified by the OCR software. Below is a small excerpt from one such json file with data for a single word 'WHOLE':
```json
{
  "textAnnotations": [
   {
     "description": "WHOLE",
     "boundingPoly": {
       "vertices": [
         {
           "x": 212,
           "y": 181
         },
         {
           "x": 573,
           "y": 197
         },
         {
           "x": 568,
           "y": 297
         },
         {
           "x": 208,
           "y": 281
         }
       ]
     }
   },
   ...
 ]
}
```
I decided that of all the information available I only needed individual words data (word text plus coordinates of word's bounding box). I also wanted to save the data in a flat table. So I wrote a short parser script that did the following:
1. Read json
2. Crop whitespace around receipt
3. Adjust receipt width to 300px and flush it to top left
4. Detect receipt orientation and rotate if necessary
5. Save data into a csv file

### Usage

To run the script clone the repository to any folder on your local machine, download json files (https://s3.amazonaws.com/receipt-labeler/receipt_jsons.zip), unzip and put them in the `jsons` folder.
Then simply run `python parse_labeler.py`. Numpy and pandas are only dependencies required. Use python 3.

After running the script you will have two csv files in the `data` folder: one with receipt data and another one with word data.

### Next steps
I used the resulting receipt words data (text and coordinates) in my next project [Receipt Labeler](https://github.com/glebkorolkov/receipt-labeler). It is a web-based visualization tool that reconstructs receipts from their word data and allows the user to label certain words as 'Total', 'Sub-total', 'Tax', 'Merchant' or 'Date'. Labels could then be used to train a machine learning model to identify those metrics on a receipt.
